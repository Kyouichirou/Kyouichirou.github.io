<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Lian个人博客-数据与思考">
<meta name="description" content="Make Thing Better and Simpler">
<meta name="theme-color" content="#000">
<title>MySQL翻译系列-Window Function Frame Specification | Lian</title>
<link rel="shortcut icon" href="/favicon.ico?v=1758516680740">
<link rel="stylesheet" href="/media/css/mist.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/tomorrow-night.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/media/js/jquery.js"></script>
<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.18.0/languages/vbnet.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.18.0/languages/vbscript-html.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.18.0/languages/vbscript.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.18.0/languages/sql.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/velocity/1.5.1/velocity.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/velocity/1.5.1/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.11.1/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ["\\(", "\\)"]],
      displayMath: [['$$', '$$'], ["\\[", "\\]"]]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'a', 'annotation', 'annotation-xml'],
      ignoreHtmlClass: 'tex2jax_ignore|crayon-.*', // 'crayon-' 开头的类，属于Wordpress代码高亮库，这部分不需要处理，否则会导致显示不正确,这部分是正则式，多条之间用'|'分割
      processHtmlClass: 'tex2jax_process'
    },
    //禁用右键菜单	
    renderActions: {
      addMenu: [0, '', '']
    }
  };
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




<script>
  var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?19bd452dc174a21cc99fb66ddfcef0cc";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>



  <meta name="description" content="MySQL翻译系列-Window Function Frame Specification" />
  <meta name="keywords" content="priority,translation,mysql" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="mist">
  <header class="header bg-color ">
    <div class="blog-header box-shadow-wrapper  " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="">
              <span class="logo-line-before">
                <i class=""></i>
              </span>
              <span class="main-title">Lian</span>
              <span class="logo-line-after">
                <i class=""></i>
              </span>
            </a>  
          
        </div>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-globe"></i> Home
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives" target="_self">
                  <i class="fa fa-globe"></i> Archives
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags" target="_self">
                  <i class="fa fa-globe"></i> Tags
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="https://Kyouichirou.github.io/post/about-me" target="_self">
                  <i class="fa fa-globe"></i> About
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </li>
            
          
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout mist bg-color">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper  right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">文章目录</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">站点概览</span>
          </div>
        </div>
      
      <div class="sidebar-body mist" id="sidebar_body">
        
          
            
<div class="sidebar-wrapper box-shadow-wrapper ">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Lian</p>
    
    <div class="site-description right-motion">
      
      
      
        <p>make thing better and simpler.</p>
      
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">103</span>
        <span class="site-item-stat-name language" data-lan="article">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">64</span>
        <span class="site-item-stat-name language" data-lan="tag">标签</span>
      </a>
    </div>
  </div>
  
  



</div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    jQuery.Velocity(hideElement, 'stop');
    jQuery.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        jQuery.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <section class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://Kyouichirou.github.io/post/mysql-fan-yi-xi-lie-window-function-frame-specification/"> MySQL翻译系列-Window Function Frame Specification </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">发布于</span>
      <span class="publish-time" data-t="2023-02-03 10:38:04">2023-02-03</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show language" data-lan="category-in">标签:</span>
       
      <a href="https://Kyouichirou.github.io/tag/7svOER7Ka/"> <span>priority</span> </a>、   
      <a href="https://Kyouichirou.github.io/tag/T5dhhKFc0/"> <span>translation</span> </a>、   
      <a href="https://Kyouichirou.github.io/tag/53itHjBFa/">
        <span>mysql</span>
      </a>
       
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span
        >14<span class="language" data-lan="minute"
          >分钟</span
        ></span
      >
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span
        >2635<span class="pc-show language" data-lan="words"
          >字数</span
        ></span
      >
    </span>
    
  </div>
</section>

            <div class="post-body next-md-body" id="post_body">
              <p>注: <code>frame</code>这里翻译为帧, 取其在行数据上滚动如同胶卷滚动前行之义.</p>
<p><em>(以下内容实际上陈述的是如何定义滚动窗口的数据范围)</em></p>
<p>The definition of a window used with a window function can include a frame clause. A frame is a subset of the current partition and the frame clause specifies how to define the subset.</p>
<p>与窗口函数一起使用的窗口的定义可以包括帧子语句, 帧是当前分区的子集，帧语句确定如何定义这个子集.</p>
<!--more-->
<p>Frames are determined with respect to the current row, which enables a frame to move within a partition depending on the location of the current row within its partition. Examples:</p>
<p>帧是根据当前行确定的，这使得帧可以根据当前行在分区中的位置在分区中移动, 例如:</p>
<ul>
<li>By defining a frame to be all rows from the partition start to the current row, you can compute running totals for each row.</li>
<li>通过将一个帧定义为从分区开始到当前行的所有行，可以计算针对每一行的整体结果.</li>
<li>By defining a frame as extending <em><code>N</code></em> rows on either side of the current row, you can compute rolling averages.</li>
<li>通定义帧使用定义当前行和 <code>N</code>行之间, 可以进行滚动的计算.(滑动窗口)</li>
</ul>
<p>The following query demonstrates the use of moving frames to compute running totals within each group of time-ordered <code>level</code> values, as well as rolling averages computed from the current row and the rows that immediately precede and follow it:</p>
<p>下面的查询演示了如何使用移动帧来计算每组按时间顺序排列的“水平”值中的运行总数，以及从当前行和紧随其后的行计算的滚动平均值:</p>
<pre><code class="language-sql">mysql&gt; SELECT
         time, subject, val,
         SUM(val) OVER (PARTITION BY subject ORDER BY time
                        ROWS UNBOUNDED PRECEDING)
           AS running_total,
         AVG(val) OVER (PARTITION BY subject ORDER BY time
                        ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)
           AS running_average
       FROM observations;
+----------+---------+------+---------------+-----------------+
| time     | subject | val  | running_total | running_average |
+----------+---------+------+---------------+-----------------+
| 07:00:00 | st113   |   10 |            10 |          9.5000 |
| 07:15:00 | st113   |    9 |            19 |         14.6667 |
| 07:30:00 | st113   |   25 |            44 |         18.0000 |
| 07:45:00 | st113   |   20 |            64 |         22.5000 |
| 07:00:00 | xh458   |    0 |             0 |          5.0000 |
| 07:15:00 | xh458   |   10 |            10 |          5.0000 |
| 07:30:00 | xh458   |    5 |            15 |         15.0000 |
| 07:45:00 | xh458   |   30 |            45 |         20.0000 |
| 08:00:00 | xh458   |   25 |            70 |         27.5000 |
+----------+---------+------+---------------+-----------------+
</code></pre>
<p>For the <code>running_average</code> column, there is no frame row preceding the first one or following the last. In these cases, <a href="https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_avg"><code>AVG()</code></a> computes the average of the rows that are available.</p>
<p><em>(为什么这些描述这么晦涩?)</em></p>
<p>对于<code>running_average</code>列, 假如帧(<code>ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING</code>, 这里的数据范围是前一行后一行以及自身)的前后(第一行没有后一行, 最前面的一行没有前面的一行)出现没有数据的情况, <code>avg</code>函数将根据获取到的具体行数来计算数值.</p>
<p>Aggregate functions used as window functions operate on rows in the current row frame, as do these nonaggregate window functions:</p>
<p>通常聚合函数用于窗口窗口函数, 以下这些是非聚合函数.</p>
<pre><code class="language-sql">FIRST_VALUE()
LAST_VALUE()
NTH_VALUE()
</code></pre>
<p>Standard SQL specifies that window functions that operate on the entire partition should have no frame clause. MySQL permits a frame clause for such functions but ignores it. These functions use the entire partition even if a frame is specified:</p>
<p>标准SQL语句要求的是窗口函数应该对整个<strong>分区</strong>进行操作, 不应该有帧子语句. MySQL支持帧子语句, 但是在这些函数中, 子语句将被忽略, 那怕这些子语句存在.</p>
<p>这段话的理解就是, 这些语句是针对全局的, 例如排名, 显然不能再针对分区排名时, 再出现对子部分进行排名的可能, 所以MySQL会忽略这些子子语句, 而作用于全局.</p>
<pre><code class="language-sql"># 作用于整个分区
CUME_DIST()
DENSE_RANK()
LAG()
LEAD()
NTILE()
PERCENT_RANK()
RANK()
ROW_NUMBER()
</code></pre>
<figure data-type="image" tabindex="1"><a href="https://imgse.com/i/pSgb0YD"><img src="https://s1.ax1x.com/2023/02/07/pSgb0YD.png" alt="pSgb0YD.png" loading="lazy"></a></figure>
<p>当再前面使用<code>count(), sum()</code>之类的, 指定的滚动窗口范围才会生效</p>
<p>The frame clause, if given, has this syntax:</p>
<p>语法结构:</p>
<pre><code class="language-sql">frame_clause:
    frame_units frame_extent

frame_units:
    {ROWS | RANGE}
</code></pre>
<p>In the absence of a frame clause, the default frame depends on whether an <code>ORDER BY</code> clause is present, as described later in this section.</p>
<p>在没有帧语句得情况下, 默认得帧将取决于<code>order by</code>是否存在.</p>
<p>The <em><code>frame_units</code></em> value indicates the type of relationship between the current row and frame rows:</p>
<p>帧的单元结构, 和当前行的关系</p>
<ul>
<li><code>ROWS</code>: The frame is defined by beginning and ending row positions. Offsets are differences in row numbers from the current row number.</li>
<li>行, 这容易理解, 就是起始行, 结尾行, 根据偏移值来划定帧的范围</li>
<li><code>RANGE</code>: The frame is defined by rows within a value range. Offsets are differences in row values from the current row value.</li>
<li>根据一定的数值范围来划定帧的范围, 例如日期, 数值等.</li>
</ul>
<p>The <em><code>frame_extent</code></em> value indicates the start and end points of the frame. You can specify just the start of the frame (in which case the current row is implicitly the end) or use <code>BETWEEN</code> to specify both frame endpoints:</p>
<p>帧得起始和结尾得定义方式</p>
<pre><code class="language-sql">frame_extent:
    {frame_start | frame_between}

frame_between:
    BETWEEN frame_start AND frame_end

frame_start, frame_end: {
    CURRENT ROW
  | UNBOUNDED PRECEDING
  | UNBOUNDED FOLLOWING
  | expr PRECEDING
  | expr FOLLOWING
}
</code></pre>
<p>With <code>BETWEEN</code> syntax, <em><code>frame_start</code></em> must not occur later than <em><code>frame_end</code></em>.</p>
<p>The permitted <em><code>frame_start</code></em> and <em><code>frame_end</code></em> values have these meanings:</p>
<ul>
<li>
<p><code>CURRENT ROW</code>: For <code>ROWS</code>, the bound is the current row. For <code>RANGE</code>, the bound is the peers of the current row.</p>
</li>
<li>
<p>当前行</p>
</li>
<li>
<p><code>UNBOUNDED PRECEDING</code>: The bound is the first partition row.</p>
</li>
<li>
<p>第一行(分区的起始边界)</p>
</li>
<li>
<p><code>UNBOUNDED FOLLOWING</code>: The bound is the last partition row.</p>
</li>
<li>
<p>最后一行(分区的最后的边界)</p>
</li>
<li>
<p><code>*</code>expr<code>* PRECEDING</code>: For <code>ROWS</code>, the bound is <em><code>expr</code></em> rows before the current row. For <code>RANGE</code>, the bound is the rows with values equal to the current row value minus <em><code>expr</code></em>; if the current row value is <code>NULL</code>, the bound is the peers of the row.</p>
<p>For <code>*</code>expr<code>* PRECEDING</code> (and <code>*</code>expr<code>* FOLLOWING</code>), <em><code>expr</code></em> can be a <code>?</code> parameter marker (for use in a prepared statement), a nonnegative numeric literal, or a temporal interval of the form <code>INTERVAL *</code>val<code>* *</code>unit<code>*</code>. For <code>INTERVAL</code> expressions, <em><code>val</code></em> specifies nonnegative interval value, and <em><code>unit</code></em> is a keyword indicating the units in which the value should be interpreted. (For details about the permitted <em><code>units</code></em> specifiers, see the description of the <a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_date-add"><code>DATE_ADD()</code></a> function in <a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html">Section 12.7, “Date and Time Functions”</a>.)</p>
<p>常量得使用, 如日期之间得间隔范围.</p>
<p><code>RANGE</code> on a numeric or temporal <em><code>expr</code></em> requires <code>ORDER BY</code> on a numeric or temporal expression, respectively.</p>
<p>Examples of valid <code>*</code>expr<code>* PRECEDING</code> and <code>*</code>expr<code>* FOLLOWING</code> indicators:</p>
<pre><code class="language-sql">10 PRECEDING
INTERVAL 5 DAY PRECEDING
5 FOLLOWING
INTERVAL '2:30' MINUTE_SECOND FOLLOWING
</code></pre>
</li>
<li>
<p><code>*</code>expr<code>* FOLLOWING</code>: For <code>ROWS</code>, the bound is <em><code>expr</code></em> rows after the current row. For <code>RANGE</code>, the bound is the rows with values equal to the current row value plus <em><code>expr</code></em>; if the current row value is <code>NULL</code>, the bound is the peers of the row.</p>
</li>
<li>
<p>注意null的存在.</p>
<p>For permitted values of <em><code>expr</code></em>, see the description of <code>*</code>expr<code>* PRECEDING</code>.</p>
</li>
</ul>
<p>The following query demonstrates <a href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_first-value"><code>FIRST_VALUE()</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_last-value"><code>LAST_VALUE()</code></a>, and two instances of <a href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_nth-value"><code>NTH_VALUE()</code></a>:</p>
<p>演示例子</p>
<pre><code class="language-sql">mysql&gt; SELECT
         time, subject, val,
         FIRST_VALUE(val)  OVER w AS 'first',
         LAST_VALUE(val)   OVER w AS 'last',
         NTH_VALUE(val, 2) OVER w AS 'second',
         NTH_VALUE(val, 4) OVER w AS 'fourth'
       FROM observations
       WINDOW w AS (PARTITION BY subject ORDER BY time
                    ROWS UNBOUNDED PRECEDING);
+----------+---------+------+-------+------+--------+--------+
| time     | subject | val  | first | last | second | fourth |
+----------+---------+------+-------+------+--------+--------+
| 07:00:00 | st113   |   10 |    10 |   10 |   NULL |   NULL |
| 07:15:00 | st113   |    9 |    10 |    9 |      9 |   NULL |
| 07:30:00 | st113   |   25 |    10 |   25 |      9 |   NULL |
| 07:45:00 | st113   |   20 |    10 |   20 |      9 |     20 |
| 07:00:00 | xh458   |    0 |     0 |    0 |   NULL |   NULL |
| 07:15:00 | xh458   |   10 |     0 |   10 |     10 |   NULL |
| 07:30:00 | xh458   |    5 |     0 |    5 |     10 |   NULL |
| 07:45:00 | xh458   |   30 |     0 |   30 |     10 |     30 |
| 08:00:00 | xh458   |   25 |     0 |   25 |     10 |     30 |
+----------+---------+------+-------+------+--------+--------+
</code></pre>
<p>Each function uses the rows in the current frame, which, per the window definition shown, extends from the first partition row to the current row. For the <a href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_nth-value"><code>NTH_VALUE()</code></a> calls, the current frame does not always include the requested row; in such cases, the return value is <code>NULL</code>.</p>
<p>更多具体得例子见<code>MySQL窗口函数(Window Function)详解</code>这篇文章.</p>
<p>In the absence of a frame clause, the default frame depends on whether an <code>ORDER BY</code> clause is present:</p>
<ul>
<li>
<p>With <code>ORDER BY</code>: The default frame includes rows from the partition start through the current row, including all peers of the current row (rows equal to the current row according to the <code>ORDER BY</code> clause). The default is equivalent to this frame specification:</p>
<pre><code class="language-sql">RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
# 这需要知道等价于这个语句(显式声明)即可
</code></pre>
</li>
<li>
<p>Without <code>ORDER BY</code>: The default frame includes all partition rows (because, without <code>ORDER BY</code>, all partition rows are peers). The default is equivalent to this frame specification:</p>
<p>(注意项): order by的作用, 默认帧包含所有的分区行, 没有<code>order by</code>将所有得行都是为等同得行.</p>
<pre><code class="language-sql">RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
</code></pre>
</li>
</ul>
<p>Because the default frame differs depending on presence or absence of <code>ORDER BY</code>, adding <code>ORDER BY</code> to a query to get deterministic results may change the results. (For example, the values produced by <a href="https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_sum"><code>SUM()</code></a> might change.) To obtain the same results but ordered per <code>ORDER BY</code>, provide an explicit frame specification to be used regardless of whether <code>ORDER BY</code> is present.</p>
<p><strong>注意</strong>帧因<code>order by</code>的存在而不同, 得到的结果会产生差异, 例如<code>sum</code>函数返回的结果. 为了获得相同的结果, 但是需要使用order by进行排序的, 提供显示声明针对帧的具体范围.</p>
<p>The meaning of a frame specification can be nonobvious when the current row value is <code>NULL</code>. Assuming that to be the case, these examples illustrate how various frame specifications apply:</p>
<pre><code class="language-bash">mysql&gt; select *, sum(v) over (order by v asc) from test_h;
+------+------------------------------+
| v    | sum(v) over (order by v asc) |
+------+------------------------------+
| NULL |                         NULL |
| NULL |                         NULL |
|    1 |                            1 |
|    2 |                            3 |
|    3 |                            6 |
|    4 |                           10 |
|    5 |                           15 |
|    6 |                           21 |
|    7 |                           28 |
|    8 |                           36 |
|    9 |                           45 |
|   11 |                           56 |
|   12 |                           68 |
|   13 |                           81 |
|   14 |                           95 |
+------+------------------------------+
15 rows in set (0.00 sec)

mysql&gt; select *, sum(v) over (order by v asc range between 10 following and 15 following) from test_h;
+------+--------------------------------------------------------------------------+
| v    | sum(v) over (order by v asc range between 10 following and 15 following) |
+------+--------------------------------------------------------------------------+
| NULL |                                                                     NULL |
| NULL |                                                                     NULL |
|    1 |                                                                       50 |
|    2 |                                                                       39 |
|    3 |                                                                       27 |
|    4 |                                                                       14 |
|    5 |                                                                     NULL |
|    6 |                                                                     NULL |
|    7 |                                                                     NULL |
|    8 |                                                                     NULL |
|    9 |                                                                     NULL |
|   11 |                                                                     NULL |
|   12 |                                                                     NULL |
|   13 |                                                                     NULL |
|   14 |                                                                     NULL |
+------+--------------------------------------------------------------------------+
15 rows in set (0.00 sec)

mysql&gt; select *, sum(v) over (order by v rows between 10 following and 15 following) from test_h;
+------+---------------------------------------------------------------------+
| v    | sum(v) over (order by v rows between 10 following and 15 following) |
+------+---------------------------------------------------------------------+
| NULL |                                                                  59 |
| NULL |                                                                  50 |
|    1 |                                                                  39 |
|    2 |                                                                  27 |
|    3 |                                                                  14 |
|    4 |                                                                NULL |
|    5 |                                                                NULL |
|    6 |                                                                NULL |
|    7 |                                                                NULL |
|    8 |                                                                NULL |
|    9 |                                                                NULL |
|   11 |                                                                NULL |
|   12 |                                                                NULL |
|   13 |                                                                NULL |
|   14 |                                                                NULL |
+------+---------------------------------------------------------------------+
15 rows in set (0.00 sec)
</code></pre>
<p>简而言之, <code>null</code>的存在增加了运算的不确定性.</p>
<p>当前行值假设为为'<code>NULL </code>时，帧规范的含义可能失效(异常). 详情见下面例子(这些例子演示的是null值得存在, 对于运算得影响.)</p>
<ul>
<li>
<p><code>ORDER BY X ASC RANGE BETWEEN 10 FOLLOWING AND 15 FOLLOWING</code>, 1</p>
<p>The frame starts at <code>NULL</code> and stops at <code>NULL</code>, thus includes only rows with value <code>NULL</code>.</p>
<p>帧开始于<code>NULL</code>，结束于<code>NULL</code>, 因此只包含值为<code>NULL</code>的行.</p>
</li>
<li>
<p><code>ORDER BY X ASC RANGE BETWEEN 10 FOLLOWING AND UNBOUNDED FOLLOWING</code>, 2</p>
<p>The frame starts at <code>NULL</code> and stops at the end of the partition. Because an <code>ASC</code> sort puts <code>NULL</code> values first, the frame is the entire partition.</p>
<p>帧开始于<code>null</code>值, 终止于分区边界(<code>BETWEEN 10 FOLLOWING AND UNBOUNDED FOLLOWING</code>). 因为<code>ASC</code>排序, 将<code>null</code>值放置到分区的第一行, 实际使得这个语句具体执行范围是整个分区(等价于<code>RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING</code>)</p>
</li>
<li>
<p><code>ORDER BY X DESC RANGE BETWEEN 10 FOLLOWING AND UNBOUNDED FOLLOWING</code>, 3</p>
<p>The frame starts at <code>NULL</code> and stops at the end of the partition. Because a <code>DESC</code> sort puts <code>NULL</code> values last, the frame is only the <code>NULL</code> values.</p>
<p>类似于 语句 1</p>
</li>
<li>
<p><code>ORDER BY X ASC RANGE BETWEEN 10 PRECEDING AND UNBOUNDED FOLLOWING</code>, 4</p>
<p>The frame starts at <code>NULL</code> and stops at the end of the partition. Because an <code>ASC</code> sort puts <code>NULL</code> values first, the frame is the entire partition.</p>
<p>类似于 语句 2</p>
</li>
<li>
<p><code>ORDER BY X ASC RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING</code>, 5</p>
<p>The frame starts at <code>NULL</code> and stops at <code>NULL</code>, thus includes only rows with value <code>NULL</code>.</p>
<p>类似于 语句 1</p>
</li>
<li>
<p><code>ORDER BY X ASC RANGE BETWEEN 10 PRECEDING AND 1 PRECEDING</code>, 6</p>
<p>The frame starts at <code>NULL</code> and stops at <code>NULL</code>, thus includes only rows with value <code>NULL</code>.</p>
<p>类似于 语句 1</p>
</li>
<li>
<p><code>ORDER BY X ASC RANGE BETWEEN UNBOUNDED PRECEDING AND 10 FOLLOWING</code>, 7</p>
<p>The frame starts at the beginning of the partition and stops at rows with value <code>NULL</code>. Because an <code>ASC</code> sort puts <code>NULL</code> values first, the frame is only the <code>NULL</code> values.</p>
<p>类似于 语句 1</p>
</li>
</ul>

            </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">本文作者：</strong>
      Lian
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">本文链接：</strong>
      <a href="https://Kyouichirou.github.io/post/mysql-fan-yi-xi-lie-window-function-frame-specification/" title="MySQL翻译系列-Window Function Frame Specification">https://Kyouichirou.github.io/post/mysql-fan-yi-xi-lie-window-function-frame-specification/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">版权声明： </strong>
      本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！
    </li>
  </ul>
  <div class="tags">
    
      <a href="https://Kyouichirou.github.io/tag/7svOER7Ka/"># priority</a>
    
      <a href="https://Kyouichirou.github.io/tag/T5dhhKFc0/"># translation</a>
    
      <a href="https://Kyouichirou.github.io/tag/53itHjBFa/"># mysql</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
        <i class="fa fa-chevron-left"></i>
        <a class="nav-pc-next" title="Python 正则表达式的差异" href="https://Kyouichirou.github.io/post/python-zheng-ze-biao-da-de-chai-yi/">Python 正则表达式的差异</a class="nav-pc-next">
        <a class="nav-mobile-prev" title="Python 正则表达式的差异" href="https://Kyouichirou.github.io/post/python-zheng-ze-biao-da-de-chai-yi/">上一篇</a>
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="MySQL翻译系列-Window Function Restrictions" href="https://Kyouichirou.github.io/post/mysql-fan-yi-xi-lie-window-function-restrictions/">MySQL翻译系列-Window Function Restrictions</a>
        <a class="nav-mobile-next" title="MySQL翻译系列-Window Function Restrictions" href="https://Kyouichirou.github.io/post/mysql-fan-yi-xi-lie-window-function-restrictions/">下一篇</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <center id="runTimeBox">
      已运行:<span id="run_time"></span>
    </center>
    <span id="busuanzi_container_site_pv">浏览数:<span id="busuanzi_value_site_pv"></span> 次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">访客数:<span id="busuanzi_value_site_uv"></span> 人</span>

    <script>
      BirthDay = new Date('');
      if (BirthDay.getTime()) {
        function runTime() {
          str = "";
          today = new Date();
          timeold = today.getTime() - BirthDay.getTime();
          msPerDay = 24 * 60 * 60 * 1000;
          e_daysold = timeold / msPerDay;
          daysold = Math.floor(e_daysold);
          str += daysold + "天";
          return str;
        }
        setInterval(function () {
          $("#run_time").html(runTime());
        }, 1000);
      } else {
        document.querySelector('.footer').removeChild(document.querySelector('#runTimeBox'));
      }
    </script>
    <div class="poweredby">
      Powered by <a href="https://github.com/Kyouichirou" target="_blank">Kyouichirou</a>
    </div>
  </footer>
  
    
      <div class="drawer-box left" id="drawer_box">
        <span class="muse-line muse-line-first"></span>
        <span class="muse-line muse-line-middle"></span>
        <span class="muse-line muse-line-last"></span>
      </div>
      
        <div class="mist back-to-top" id="back_to_top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
        
          
            
              <div class="bg-img">
                <img src="https://s1.ax1x.com/2023/03/24/ppBNvm6.jpg" />
              </div>
              
                
                  
                        
</div>
<script>
  let sideBarOpen = "sidebar-open";
  let body = document.body;
  let back2Top = document.querySelector("#back_to_top"),
    back2TopText = document.querySelector("#back_to_top_text"),
    drawerBox = document.querySelector("#drawer_box"),
    rightSideBar = document.querySelector(".sidebar"),
    viewport = document.querySelector("body");

  function scrollAnimation(currentY, targetY) {
    let needScrollTop = targetY - currentY;
    let _currentY = currentY;
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10);
      _currentY += dist;
      window.scrollTo(_currentY, currentY);
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY);
      } else {
        window.scrollTo(_currentY, targetY);
      }
    }, 1);
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener("scroll", function (e) {
    let percent =
      (document.scrollingElement.scrollTop /
        (document.scrollingElement.scrollHeight -
          document.scrollingElement.clientHeight)) *
      100;
    if (percent > 1 && !back2Top.classList.contains("back-top-active")) {
      back2Top.classList.add("back-top-active");
    }
    if (percent == 0) {
      back2Top.classList.remove("back-top-active");
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  let hasCacu = false;
  window.addEventListener("resize", function (e) {
    calcuHeight();
  });

  function calcuHeight() {
    // 动态调整站点概览高度
    if (
      (!hasCacu && back2Top.classList.contains("pisces")) ||
      back2Top.classList.contains("gemini")
    ) {
      let sideBar = document.querySelector(".sidebar");
      let navUl = document.querySelector("#site_nav");
      sideBar.style =
        "margin-top:" + (navUl.offsetHeight + navUl.offsetTop + 15) + "px;";
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false,
    MOTION_TIME = 300,
    RIGHT_MOVE_DIS = "320px";

  if (drawerBox) {
    let rightMotions = document.querySelectorAll(".right-motion");
    let right = drawerBox.classList.contains("right");

    let transitionDir = right
      ? "transition.slideRightIn"
      : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS,
      };
      closeProp = {
        paddingRight: "0px",
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS,
      };
      closeProp = {
        paddingLeft: "0px",
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      jQuery.Velocity(rightSideBar, "stop");
      jQuery.Velocity(viewport, "stop");
      jQuery.Velocity(rightMotions, "stop");
      if (open) {
        jQuery.Velocity(
          rightSideBar,
          {
            width: RIGHT_MOVE_DIS,
          },
          {
            duration: MOTION_TIME,
            begin: function () {
              jQuery.Velocity(rightMotions, transitionDir, {});
            },
          }
        );
        jQuery.Velocity(viewport, openProp, {
          duration: MOTION_TIME,
        });
      } else {
        jQuery.Velocity(
          rightSideBar,
          {
            width: "0px",
          },
          {
            duration: MOTION_TIME,
            begin: function () {
              jQuery.Velocity(rightMotions, {
                opacity: 0,
              });
            },
          }
        );
        jQuery.Velocity(viewport, closeProp, {
          duration: MOTION_TIME,
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle("muse-line");
      }
      drawerBox.classList.toggle(sideBarOpen);
    };
  }

  // 链接跳转
  let newWindow = "false";
  if (newWindow === "true") {
    let links = document.querySelectorAll(".post-body a");
    links.forEach((item) => {
      if (!item.classList.contains("btn")) {
        item.setAttribute("target", "_blank");
      }
    });
  }

  let faSearch = document.querySelector("#fa_search");
  faSearch &&
    faSearch.addEventListener("click", function () {
      document.querySelector("#search_mask").style = "";
    });

  // 代码高亮
  hljs.initHighlightingOnLoad();

  // 离开当前页title变化
  var leaveTitle = "";
  var normal_title = document.title;
  if (leaveTitle) {
    document.addEventListener("visibilitychange", function () {
      if (document.visibilityState == "hidden") {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }
</script>

<link rel="stylesheet" href="/media/css/jquery.fancybox.css" />
<script src="/media/js/jquery.fancybox.js"></script>

<script>
  let images = document.querySelectorAll(".section img");
  images.forEach((image) => {
    var parent = image.parentElement;
    var next = image.nextElementSibling;
    parent.removeChild(image);
    var aelem = document.createElement("a");
    aelem.href = image.src;
    aelem.dataset["fancybox"] = "images";
    aelem.dataset["rel"] = "fancybox-button";
    aelem.classList.add("fancybox");
    aelem.appendChild(image);
    parent.insertBefore(aelem, next);
  });
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>感谢您的支持，我会继续努力的!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
          
        </div>
      </div>
      <p class="reward-word">扫码打赏，你说多少就多少</p>
      <p class="reward-tip"> </p>
    </div>
    <div class="bottom">
      
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        jQuery.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        jQuery.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        jQuery.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        jQuery.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn && rewardBtn.addEventListener('click', (e) => {
      jQuery.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      jQuery.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

<input hidden id="copy" />
<script>
  !function () {
    let times = document.querySelectorAll('.publish-time');
    for (let i = 0; i < times.length; i++) {
      let date = times[i].dataset.t;
      let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
      if (time < 60) {
        str = time + '秒之前';
      } else if (time < 3600) {
        str = Math.floor(time / 60) + '分钟之前';
      } else if (time >= 3600 && time < 86400) {
        str = Math.floor(time / 3600) + '小时之前';
      } else if (time >= 86400 && time < 259200) {
        str = Math.floor(time / 86400) + '天之前';
      } else {
        str = times[i].textContent;
      }
      times[i].textContent = str;
    }
  }();
</script>

<script>
  let language = 'en';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }

  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>


  <script
    src="https://cdn.staticfile.org/smooth-scroll/16.1.3/smooth-scroll.polyfills.min.js"></script>
  <script>
    var scroll = new SmoothScroll('a[href*="#"]', {
      speed: 200
    });
  </script>






  <div class="snow-container"></div>
  <script src="/media/js/bg/snow.js"></script>

</html>